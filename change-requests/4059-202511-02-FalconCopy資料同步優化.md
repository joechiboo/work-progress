製表日期： 114 年 11 月 25 日                  紀錄編號：4059-202511-02
部門名稱：資訊部                              填表人員：紀伯喬

變更項目：FalconCopy 資料同步優化

預定執行期程：自 114 年 11 月 04 日 至 114 年 11 月 25 日止

---

## 變更需求

變更原因及內容說明：

FalconCopy 資料同步系統發現嚴重的重複同步問題，每次同步週期產生 3000+ 筆重複資料，需緊急修正並強化系統穩定性。

**變更原因：**
1. 資料同步邏輯存在重複同步問題，每次同步週期產生大量重複資料（3000+ 筆）
2. 新舊系統（桃園分部）判斷邏輯錯誤，導致同步方向異常
3. 缺乏髒資料診斷與清理工具
4. 孤兒資料（無對應主檔的明細資料）未妥善處理
5. pat_resultd 明細資料無法整單刷新，僅能逐筆更新

**變更內容：**
1. 修正重複同步邏輯，根據 IsTaoyuanStation 設定正確判斷新舊系統
2. 修復檢驗項目刪除時的同步問題
3. 新增髒資料診斷與清理腳本（Scripts 目錄重組）
4. 新增孤兒資料處理功能
5. 實現 pat_resultd 整單刷新機制（完整記錄同步）
6. 新增 log 自動清理功能（保留 7 天內記錄）
7. 新增排程執行架構說明文件

**影響範圍：** OnlineReport\FalconCopy 資料同步服務

申請人員：紀伯喬

---

## 變更評估

**影響分析：**
- 影響模組：FalconCopy 資料同步服務
- 影響資料表：pat_resultd（檢驗結果明細）、相關同步狀態表
- 資料庫：Oracle 查詢邏輯調整、新增清理腳本
- 無需停機，同步服務可熱更新
- 備份作業：部署前備份現有程式及同步狀態資料
- 變更失敗處理：回復至前一版本程式，重新執行全量同步

評估人員：紀伯喬

---

## 變更處理

已依原規劃方式完成變更作業：
1. 重複同步問題已修正，每週期同步量恢復正常
2. 桃園分部新舊系統判斷正確運作
3. 髒資料診斷工具已部署，可定期執行檢查
4. 孤兒資料處理功能上線
5. pat_resultd 整單刷新機制驗證通過
6. Log 自動清理每日執行正常

執行人員：紀伯喬

---

## 結果確認

已確認依照原規劃方式執行變更，FalconCopy 資料同步穩定運作，重複同步問題已解決。

確認人員：

安全測試結果：
☒ 無須進行測試
